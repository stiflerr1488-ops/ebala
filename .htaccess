# Cache & performance (np-maps.ru)

# Ensure correct MIME types
<IfModule mod_mime.c>
  AddType application/manifest+json .webmanifest
  AddType image/svg+xml .svg
  AddType text/css .css
  AddType application/javascript .js
</IfModule>

# Cache policy:
# - HTML: always revalidate (so content updates show instantly)
# - Static assets: long cache (files are versioned via ?v=)
<IfModule mod_headers.c>
  <FilesMatch "\.(html?)$">
    Header set Cache-Control "no-cache, must-revalidate"
  </FilesMatch>

  <FilesMatch "\.(css|js|png|jpg|jpeg|gif|webp|svg|ico|woff2?|ttf|eot)$">
    Header set Cache-Control "public, max-age=31536000, immutable"
  </FilesMatch>

  <FilesMatch "\.(webmanifest)$">
    Header set Cache-Control "public, max-age=86400"
  </FilesMatch>
</IfModule>

# Compression (if supported by host)
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/css application/javascript application/json application/manifest+json image/svg+xml
</IfModule>

AddDefaultCharset utf-8


<IfModule mod_rewrite.c>
RewriteEngine On

# Canonical: remove trailing slash for non-directories
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+)/$ $1 [R=301,L]

# Canonical: /index.html -> /
RewriteCond %{THE_REQUEST} \s/index\.html[\s\?]
RewriteRule ^index\.html$ / [R=301,L]

# Redirect /page.html -> /page
RewriteCond %{THE_REQUEST} \s/([^\s\?]+)\.html[\s\?]
RewriteRule ^ %1 [R=301,L]

# Serve index.html for /
RewriteRule ^$ index.html [L]

# Internal rewrite: /page -> /page.html (if exists)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.html -f
RewriteRule ^(.+?)/?$ $1.html [L]
</IfModule>
